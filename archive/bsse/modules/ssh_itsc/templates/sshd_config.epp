<%- | String[1] $fqdn, $modtime, String[1] $puppetversion, | -%>
#
# This file was autogenerated on <%= $fqdn %> at <%= $modtime %> by puppet <%= $puppetversion %>.
# It can still be managed manually but will be overwritten on the next run.
#
# ================================================================================
#

Protocol 2

SyslogFacility AUTHPRIV
LogLevel INFO

<% if $facts['os']['name'] =~ /RedHat|CentOS/ && $lsbmajdistrelease > '5' { %>PermitRootLogin no
<% }else{ %>PermitRootLogin without-password
<% } %>


<% if $hostname =~ /bs-svn01|bs-svn03|bs-svn04|bs-stadler02/ { %>PasswordAuthentication no
<% } %>
<% if $hostname =~ /bs-dsvr67|bs-dsvr73/ { %>ClientAliveInterval 120
<% } %>
ChallengeResponseAuthentication no
MaxAuthTries 8
LoginGraceTime 15
#GSSAPIAuthentication yes
#GSSAPICleanupCredentials yes
X11Forwarding yes
<% if $hostname =~ /bs-svn01|bs-svn04/ { %>AuthorizedKeysFile	etc/users
<% } %>
UsePAM yes
PermitUserEnvironment yes
<% if $hostname =~ /bs-svn02|bs-svn04/ { %><% }else{ %>
AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT 
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS
<% } %>
<% if $hostname =~ /bs-ftpsvr01/ { %>Subsystem       sftp    internal-sftp
ChrootDirectory /srv/ftp/external
<% }else{ %>Subsystem	sftp	/usr/libexec/openssh/sftp-server
<% } %>
<% if $hostname =~ /bs-svn02/ { %>
Match Group svn
        AllowTcpForwarding no
        ChrootDirectory /local0/svn
<% }elsif @hostname =~ /bs-ftpsvr01/ { %>
Match Group bsse-itsc
        Banner /srv/ftp/motd
        ChrootDirectory /srv/ftp
        AllowTcpForwarding no

Match User root
        # Banner /srv/ftp/motd
        # ForceCommand internal-sftp
        ChrootDirectory /

Match Group bsse-cisd
        Banner /srv/ftp/motd
        ChrootDirectory /srv/ftp
        AllowTcpForwarding no

Match Group bsse-beerenwinkel
        Banner /srv/ftp/motd
        ChrootDirectory /srv/ftp
        AllowTcpForwarding no

Match Group bsse-paro
        Banner /srv/ftp/motd
        ChrootDirectory /srv/ftp
        AllowTcpForwarding no

Match Group BSSE-dsf
        Banner /srv/ftp/motd
        ChrootDirectory /srv/ftp
        AllowTcpForwarding no

# Match Group dsf-external
Match Group sftp-user
        Banner /srv/ftp/motd
        ChrootDirectory /srv/ftp/external
        AllowTcpForwarding no

<% } %>
<% if "ou_service_grid_nologin" in $my_classes { %>
# Block direct access to MPI nodes (to avoid misuse which can break the grid/mpi concept)
Match Address 10.20.8.0/22,129.132.228.0/23,129.132.151.192/26,195.176.122.76,195.176.122.117,195.176.122.14,195.176.122.225,195.176.122.15,195.176.122.234,195.176.122.235,129.132.27.78,2001:67c:10ec:2643::/118
        PasswordAuthentication no
        RSAAuthentication no
        PubkeyAuthentication no
<% } %>
<% if $hostname =~ /bs-svn01|bs-svn03/ { %>
# Allow access as root from BSSE net, ID-SIS dock net
Match Address 10.20.8.0/22,129.132.228.0/23,129.132.128.64/26,129.132.97.128/25,129.132.151.192/26,129.132.27.0/25,195.176.122.0/24,129.132.42.0/24,129.132.182.208/28,172.31.92.0/24,172.31.27.128/26,129.132.178.128/27,129.132.199.16/28,129.132.77.96/27,129.132.168.224/27,2001:67c:10ec:2643::/118
        PermitRootLogin without-password
<% }elsif @operatingsystem =~ /RedHat|CentOS/ && @lsbmajdistrelease > '5' { %>
Match Address 10.20.8.0/22,129.132.228.0/23,129.132.128.64/26,129.132.97.128/25,129.132.151.192/26,129.132.27.0/25,195.176.122.0/24,129.132.42.0/24,129.132.182.208/28,172.31.92.0/24,172.31.27.128/26,2001:67c:10ec:2643::/118
        PermitRootLogin without-password
<% } %>
